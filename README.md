# 智能小车项目（Smart-Car）🚗

## 项目简介
本项目是基于STM32F10x系列单片机的智能小车控制系统，支持**手动控制模式**、**超声波避障模式**和**循迹模式**三种运行模式。通过串口通信接收指令，结合多种传感器（超声波、红外循迹）实现自主移动功能。项目代码以C语言为核心开发，兼容Keil MDK开发环境。

![智能小车实物图](小车实物图.jpg)  <!-- 建议将小车实物图存放在docs/images目录 -->

---

## 核心功能特性
### 模式切换
- **手动模式（0x10）**🚦：通过串口发送指令（0x11-0x17）控制小车前进、后退、转向等动作。
- **超声波避障模式（0x20）**🛑：实时检测前方障碍物距离（`UltraSound_Measure()`），当距离小于阈值（`MIN_DISTANCE`）时触发避障逻辑（`ObstacleAvoidance()`），否则保持前进。
- **循迹模式（0x30）**📍：通过红外传感器（PB5-PB8）检测地面黑线，调整方向保持沿轨迹行驶。

### 运行状态定义
| 状态码 | 描述       |
|--------|------------|
| 0x11   | 前进       |
| 0x12   | 后退       |
| 0x13   | 右转       |
| 0x14   | 左转       |
| 0x15   | 原地右转   |
| 0x16   | 原地左转   |
| 0x17   | 停止       |

---

## 硬件模块与驱动
硬件驱动代码集中在`工程代码/Hardware`目录，包含以下核心模块（图标示意）：

### 1. 电机控制（Motor）⚡
- **功能**：驱动直流电机实现前进、后退、转向等动作。
- **关键函数**：
  - `Motor_Init()`：初始化电机GPIO和PWM。
  - `MoveForward()`/`MoveBackward()`：直行控制。
  - `Turn_Left()`/`Turn_Right()`：转向控制（单侧电机停转）。
  - `Self_Right()`/`Self_Left()`：原地旋转（两侧电机反向）。

### 2. 舵机控制（Servo）🔄
- **功能**：控制舵机角度（如超声波传感器方向调节）。
- **关键函数**：
  - `Servo_Init()`：初始化舵机PWM（周期20ms，占空比1-2ms对应0-180°）。
  - `Servo_SetAngle(float Angle)`：设置舵机角度（转换为PWM占空比）。

### 3. 循迹模块（Track）
- **功能**：通过红外传感器（PB5-PB8）检测地面黑线（高电平表示检测到黑线）。
- **关键函数**：
  - `Track_Init()`：初始化循迹传感器GPIO（浮空输入）。
  - 主循环中读取`rt`（最右）、`rm`（中右）、`lm`（中左）、`lt`（最左）引脚状态，调整行驶方向。

### 4. 超声波模块（UltraSound）
- **功能**：测量前方障碍物距离（需配合`UltraSound_Measure()`函数）。
- **说明**：主循环中若距离小于阈值则触发避障（`ObstacleAvoidance()`）。

### 5. 串口通信（Serial）
- **功能**：通过USART1接收指令，切换模式（`mode`）和运行状态（`running_statu`）。
- **中断处理**：`USART1_IRQHandler()`中解析串口数据（0x10-0x30），更新控制参数。

---

## 使用说明

### 1. 硬件连接
按以下引脚连接各模块到STM32F10x开发板（以最小系统板为例）：
![硬件连接示意图](原理图.bmp)  <!-- 建议存放硬件接线示意图 -->
- **电机**：BO1（左电机A）、BO2（左电机B）、AO1（右电机A）、AO2（右电机B）。
- **舵机**：PA1（TIM2通道2，PWM输出）。
- **超声波**：PB12（Trig触发）、PB13（Echo回波）。
- **循迹传感器**：PB5（最右）、PB6（中右）、PB7（中左）、PB8（最左）。
- **蓝牙模块**：USART1（PA9-TX，PA10-RX）。

### 2. 编译烧录
- 打开`工程代码/Project.uvprojx`（Keil MDK），选择目标芯片（如STM32F103C8T6）✅。
- 点击`编译`（F7）生成`工程代码/Objects/Project.axf`。
- 使用ST-Link连接开发板，点击`下载`（F8）烧录程序。

### 3. 模式切换
- **蓝牙控制**：
  1. 手机安装`蓝牙调试器.apk`，连接小车蓝牙模块（默认名称：SmartCar-001）。
  2. 选择`十六进制发送`模式，发送上述指令（同串口控制）。

---

## 语言说明
本项目核心代码采用**C语言**开发，基于STM32标准外设库（`stm32f10x_*.h`）实现硬件驱动。开发环境为**Keil MDK-ARM**（版本≥5.30），支持STM32F10x系列芯片（如STM32F103C8T6）。
     